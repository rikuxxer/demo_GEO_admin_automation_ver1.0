# ä¸€æ‹¬ç™»éŒ²æ©Ÿèƒ½ ãƒ•ãƒ­ãƒ¼å›³

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0  
**æœ€çµ‚æ›´æ–°æ—¥:** 2024å¹´12æœˆ  
**ä½œæˆè€…:** é–‹ç™ºãƒãƒ¼ãƒ 

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [å…¨ä½“ãƒ•ãƒ­ãƒ¼](#å…¨ä½“ãƒ•ãƒ­ãƒ¼)
3. [è©³ç´°ãƒ•ãƒ­ãƒ¼](#è©³ç´°ãƒ•ãƒ­ãƒ¼)
4. [ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³](#ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³)
5. [çŠ¶æ…‹é·ç§»å›³](#çŠ¶æ…‹é·ç§»å›³)
6. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼](#ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼)
7. [ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ•ãƒ­ãƒ¼)

---

## æ¦‚è¦

ä¸€æ‹¬ç™»éŒ²æ©Ÿèƒ½ã«ã¯ä»¥ä¸‹ã®2ã¤ã®å½¢å¼ãŒã‚ã‚Šã¾ã™ï¼š

1. **CSVå½¢å¼**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚«ãƒ¼ã‚’ä½¿ã£ãŸå¾“æ¥å½¢å¼
2. **Excelå½¢å¼**: 5ã‚·ãƒ¼ãƒˆæ§‹æˆã®æ–°å½¢å¼ï¼ˆæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä¸»çœ¼ï¼‰

---

## å…¨ä½“ãƒ•ãƒ­ãƒ¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼

```mermaid
journey
    title Excelä¸€æ‹¬ç™»éŒ²ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¸ãƒ£ãƒ¼ãƒ‹ãƒ¼
    section ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå–å¾—
      ã‚·ã‚¹ãƒ†ãƒ ã«ãƒ­ã‚°ã‚¤ãƒ³: 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰: 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼
    section ãƒ‡ãƒ¼ã‚¿å…¥åŠ›
      æ¡ˆä»¶æƒ…å ±ã‚’å…¥åŠ›: 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¨­å®šã‚’å…¥åŠ›: 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      åœ°ç‚¹ãƒªã‚¹ãƒˆã‚’å…¥åŠ›: 3: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      å…¥åŠ›å†…å®¹ã‚’ç¢ºèª: 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼
    section ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ: 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      å†…å®¹ã‚’ç¢ºèªãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯: 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ç¢ºèª: 4: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      ç™»éŒ²å®Ÿè¡Œ: 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼
    section å®Œäº†
      æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª: 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼
      æ¡ˆä»¶ä¸€è¦§ã§ç¢ºèª: 5: ãƒ¦ãƒ¼ã‚¶ãƒ¼
```

### ãƒ“ã‚¸ãƒã‚¹ãƒ•ãƒ­ãƒ¼

```mermaid
graph TB
    Start([é–‹å§‹]) --> A[å–¶æ¥­æ‹…å½“è€…ãŒ<br/>ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰]
    
    A --> B{å…¥åŠ›è€…ã¯?}
    
    B -->|å–¶æ¥­è‡ªèº«| C[å–¶æ¥­ãŒãƒ‡ãƒ¼ã‚¿å…¥åŠ›]
    B -->|åºƒå‘Šä¸»/ä»£ç†åº—| D[ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’<br/>åºƒå‘Šä¸»ã«é€ä»˜]
    
    D --> E[åºƒå‘Šä¸»ãŒãƒ‡ãƒ¼ã‚¿å…¥åŠ›]
    E --> F[å…¥åŠ›æ¸ˆã¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’<br/>å–¶æ¥­ã«é€ä»˜]
    
    C --> G[ãƒ•ã‚¡ã‚¤ãƒ«ã‚’<br/>ã‚·ã‚¹ãƒ†ãƒ ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰]
    F --> G
    
    G --> H[ã‚·ã‚¹ãƒ†ãƒ ãŒ<br/>ãƒ•ã‚¡ã‚¤ãƒ«è§£æ]
    
    H --> I{ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³<br/>OK?}
    
    I -->|ã‚¨ãƒ©ãƒ¼| J[ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º]
    J --> K{ä¿®æ­£è€…ã¯?}
    K -->|å–¶æ¥­| C
    K -->|åºƒå‘Šä¸»| L[ä¿®æ­£ä¾é ¼ã‚’åºƒå‘Šä¸»ã«é€ä»˜]
    L --> E
    
    I -->|æˆåŠŸ| M[ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢è¡¨ç¤º]
    M --> N[å–¶æ¥­ãŒå†…å®¹ç¢ºèª]
    
    N --> O{å†…å®¹OK?}
    O -->|ä¿®æ­£å¿…è¦| C
    
    O -->|OK| P[ç™»éŒ²å®Ÿè¡Œ]
    P --> Q[æ¡ˆä»¶ãƒ»ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ»åœ°ç‚¹<br/>ã‚’ä¸€æ‹¬ç™»éŒ²]
    
    Q --> R([å®Œäº†])
    
    style Start fill:#e1f5e1
    style R fill:#e1f5e1
    style J fill:#ffe1e1
    style M fill:#e1f0ff
```

---

## è©³ç´°ãƒ•ãƒ­ãƒ¼

### 1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ<br/>ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹]) --> CreateWB[Workbookã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ]
    
    CreateWB --> Sheet1[ã‚·ãƒ¼ãƒˆ1ä½œæˆ:<br/>å…¥åŠ›ã‚¬ã‚¤ãƒ‰]
    Sheet1 --> Sheet1Content[ãƒ†ã‚­ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„æŒ¿å…¥]
    Sheet1Content --> Sheet1Style[ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨<br/>ãƒ•ã‚©ãƒ³ãƒˆ/è‰²/é…ç½®]
    
    Sheet1Style --> Sheet2[ã‚·ãƒ¼ãƒˆ2ä½œæˆ:<br/>æ¡ˆä»¶æƒ…å ±]
    Sheet2 --> Sheet2Header[ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œä½œæˆ]
    Sheet2Header --> Sheet2Sample[ã‚µãƒ³ãƒ—ãƒ«è¡ŒæŒ¿å…¥]
    Sheet2Sample --> Sheet2Input[å…¥åŠ›è¡Œè¿½åŠ ]
    Sheet2Input --> Sheet2Style[ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨<br/>å¿…é ˆé …ç›®ã‚’é»„è‰²èƒŒæ™¯]
    Sheet2Style --> Sheet2Validation[æ—¥ä»˜ã®å…¥åŠ›è¦å‰‡è¨­å®š]
    
    Sheet2Validation --> Sheet3[ã‚·ãƒ¼ãƒˆ3ä½œæˆ:<br/>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¨­å®š]
    Sheet3 --> Sheet3Header[ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œä½œæˆ]
    Sheet3Header --> Sheet3Sample[ã‚µãƒ³ãƒ—ãƒ«è¡ŒæŒ¿å…¥<br/>2è¡Œ]
    Sheet3Sample --> Sheet3Input[å…¥åŠ›è¡Œè¿½åŠ ]
    Sheet3Input --> Sheet3Style[ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨<br/>å¿…é ˆé …ç›®ã‚’é»„è‰²èƒŒæ™¯<br/>ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é …ç›®ã‚’é’èƒŒæ™¯]
    
    Sheet3Style --> Sheet4[ã‚·ãƒ¼ãƒˆ4ä½œæˆ:<br/>åœ°ç‚¹ãƒªã‚¹ãƒˆ]
    Sheet4 --> Sheet4Header[ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œä½œæˆ]
    Sheet4Header --> Sheet4Sample[ã‚µãƒ³ãƒ—ãƒ«è¡ŒæŒ¿å…¥<br/>5è¡Œ]
    Sheet4Sample --> Sheet4Input[å…¥åŠ›è¡Œè¿½åŠ ]
    Sheet4Input --> Sheet4Style[ã‚¹ã‚¿ã‚¤ãƒ«é©ç”¨]
    
    Sheet4Style --> Sheet5[ã‚·ãƒ¼ãƒˆ5ä½œæˆ:<br/>é¸æŠè‚¢ãƒªã‚¹ãƒˆ]
    Sheet5 --> Sheet5Content[é¸æŠè‚¢ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥<br/>é…ä¿¡å…ˆ/ç¯„å›²/æœŸé–“/å¯¾è±¡è€…/æ¤œçŸ¥å›æ•°/æ»åœ¨æ™‚é–“]
    Sheet5Content --> Sheet5Hide[ã‚·ãƒ¼ãƒˆã‚’éè¡¨ç¤ºã«è¨­å®š]
    Sheet5Hide --> Sheet5Protect[ã‚·ãƒ¼ãƒˆã‚’ä¿è­·]
    
    Sheet5Protect --> AddDropdowns[ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³è¨­å®šè¿½åŠ ]
    AddDropdowns --> Dropdown1[ã‚·ãƒ¼ãƒˆ3 Båˆ—:<br/>é…ä¿¡å…ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]
    Dropdown1 --> Dropdown2[ã‚·ãƒ¼ãƒˆ3 Cåˆ—:<br/>é…ä¿¡ç¯„å›²ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]
    Dropdown2 --> Dropdown3[ã‚·ãƒ¼ãƒˆ3 Dåˆ—:<br/>é…ä¿¡æœŸé–“ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]
    Dropdown3 --> Dropdown4[ã‚·ãƒ¼ãƒˆ3 Eåˆ—:<br/>å¯¾è±¡è€…ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]
    Dropdown4 --> Dropdown5[ã‚·ãƒ¼ãƒˆ3 Fåˆ—:<br/>æ¤œçŸ¥å›æ•°ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]
    Dropdown5 --> Dropdown6[ã‚·ãƒ¼ãƒˆ3 Iåˆ—:<br/>æ»åœ¨æ™‚é–“ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³]
    Dropdown6 --> Dropdown7[ã‚·ãƒ¼ãƒˆ4 Aåˆ—:<br/>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåãƒ—ãƒ«ãƒ€ã‚¦ãƒ³<br/>å‹•çš„å‚ç…§: ã‚·ãƒ¼ãƒˆ3 Aåˆ—]
    
    Dropdown7 --> GenerateBinary[Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’<br/>ãƒã‚¤ãƒŠãƒªå½¢å¼ã§ç”Ÿæˆ]
    GenerateBinary --> CreateBlob[Blobã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ]
    CreateBlob --> Download[ãƒ–ãƒ©ã‚¦ã‚¶ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å®Ÿè¡Œ]
    
    Download --> End([å®Œäº†])
    
    style Start fill:#e1f5e1
    style End fill:#e1f5e1
```

### 2. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ]) --> FileInput[input type=file<br/>ã§.xlsxãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ]
    
    FileInput --> ReadFile[File APIã§<br/>ArrayBufferã¨ã—ã¦èª­ã¿è¾¼ã¿]
    
    ReadFile --> ParseXLSX[SheetJS xlsx.read<br/>ã§Workbookã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ]
    
    ParseXLSX --> CheckSheets{å¿…é ˆã‚·ãƒ¼ãƒˆ<br/>å­˜åœ¨ç¢ºèª}
    
    CheckSheets -->|ä¸è¶³| ErrorSheet[ã‚¨ãƒ©ãƒ¼:<br/>å¿…é ˆã‚·ãƒ¼ãƒˆãŒã‚ã‚Šã¾ã›ã‚“]
    ErrorSheet --> ShowError[ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º]
    ShowError --> End1([çµ‚äº†])
    
    CheckSheets -->|OK| GetSheets[å„ã‚·ãƒ¼ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå–å¾—]
    
    GetSheets --> ParseProject[ã‚·ãƒ¼ãƒˆ2<br/>æ¡ˆä»¶æƒ…å ±ãƒ‘ãƒ¼ã‚¹]
    GetSheets --> ParseSegment[ã‚·ãƒ¼ãƒˆ3<br/>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¨­å®šãƒ‘ãƒ¼ã‚¹]
    GetSheets --> ParseLocation[ã‚·ãƒ¼ãƒˆ4<br/>åœ°ç‚¹ãƒªã‚¹ãƒˆãƒ‘ãƒ¼ã‚¹]
    
    ParseProject --> ProjectData[æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ]
    ParseSegment --> SegmentData[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…åˆ—]
    ParseLocation --> LocationData[åœ°ç‚¹é…åˆ—]
    
    ProjectData --> Validate[ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ]
    SegmentData --> Validate
    LocationData --> Validate
    
    Validate --> End2([ãƒ‘ãƒ¼ã‚¹å®Œäº†])
    
    style Start fill:#e1f5e1
    style End1 fill:#ffe1e1
    style End2 fill:#e1f5e1
    style ErrorSheet fill:#ffe1e1
```

### 3. ã‚·ãƒ¼ãƒˆå€‹åˆ¥ãƒ‘ãƒ¼ã‚¹ãƒ•ãƒ­ãƒ¼

#### æ¡ˆä»¶æƒ…å ±ã‚·ãƒ¼ãƒˆã®ãƒ‘ãƒ¼ã‚¹

```mermaid
flowchart TD
    Start([æ¡ˆä»¶æƒ…å ±ã‚·ãƒ¼ãƒˆ]) --> ConvertJSON[xlsx.utils.sheet_to_json<br/>ã§JSONé…åˆ—ã«å¤‰æ›]
    
    ConvertJSON --> CheckRows{ãƒ‡ãƒ¼ã‚¿è¡ŒãŒ<br/>å­˜åœ¨?}
    
    CheckRows -->|ãªã—| ErrorNoData[ã‚¨ãƒ©ãƒ¼:<br/>æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“]
    
    CheckRows -->|ã‚ã‚Š| GetFirstRow[1è¡Œç›®ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—<br/>ã‚µãƒ³ãƒ—ãƒ«è¡Œã¯ã‚¹ã‚­ãƒƒãƒ—]
    
    GetFirstRow --> MapFields[ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒƒãƒ”ãƒ³ã‚°]
    
    MapFields --> F1[åºƒå‘Šä¸»å â†’ advertiser_name]
    MapFields --> F2[ä»£ç†åº—å â†’ agency_name]
    MapFields --> F3[è¨´æ±‚å†…å®¹ â†’ appeal_point]
    MapFields --> F4[é…ä¿¡é–‹å§‹æ—¥ â†’ delivery_start_date]
    MapFields --> F5[é…ä¿¡çµ‚äº†æ—¥ â†’ delivery_end_date]
    MapFields --> F6[å‚™è€ƒ â†’ remarks]
    
    F1 --> ValidateFields[å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯]
    F2 --> ValidateFields
    F3 --> ValidateFields
    F4 --> ValidateFields
    F5 --> ValidateFields
    F6 --> ValidateFields
    
    ValidateFields --> CheckRequired{å¿…é ˆé …ç›®<br/>ã™ã¹ã¦å…¥åŠ›æ¸ˆã¿?}
    
    CheckRequired -->|No| ErrorRequired[ã‚¨ãƒ©ãƒ¼åé›†:<br/>å¿…é ˆé …ç›®æœªå…¥åŠ›]
    
    CheckRequired -->|Yes| CheckDates{æ—¥ä»˜ã®<br/>å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯}
    
    CheckDates -->|NG| ErrorDates[ã‚¨ãƒ©ãƒ¼åé›†:<br/>æ—¥ä»˜ãŒä¸æ­£]
    
    CheckDates -->|OK| CreateObject[Projectã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ]
    
    CreateObject --> AddDefaults[ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤è¨­å®š<br/>project_status = 'æº–å‚™ä¸­']
    
    AddDefaults --> Return([æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿ã‚’è¿”å´])
    
    ErrorNoData --> Return
    ErrorRequired --> Return
    ErrorDates --> Return
    
    style Start fill:#e1f0ff
    style Return fill:#e1f5e1
    style ErrorNoData fill:#ffe1e1
    style ErrorRequired fill:#ffe1e1
    style ErrorDates fill:#ffe1e1
```

#### ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¨­å®šã‚·ãƒ¼ãƒˆã®ãƒ‘ãƒ¼ã‚¹

```mermaid
flowchart TD
    Start([ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¨­å®šã‚·ãƒ¼ãƒˆ]) --> ConvertJSON[JSONé…åˆ—ã«å¤‰æ›]
    
    ConvertJSON --> InitArray[ç©ºã®é…åˆ—ã‚’åˆæœŸåŒ–]
    
    InitArray --> LoopStart{å„è¡Œã‚’<br/>ãƒ«ãƒ¼ãƒ—å‡¦ç†}
    
    LoopStart -->|è¡Œã”ã¨| CheckSample{ã‚µãƒ³ãƒ—ãƒ«è¡Œor<br/>ç©ºè¡Œ?}
    
    CheckSample -->|Yes| LoopStart
    
    CheckSample -->|No| MapRow[è¡Œãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°]
    
    MapRow --> M1[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå â†’ segment_name]
    MapRow --> M2[é…ä¿¡å…ˆ â†’ media_id<br/>æ–‡å­—åˆ—å¤‰æ›]
    MapRow --> M3[é…ä¿¡ç¯„å›² â†’ designated_radius]
    MapRow --> M4[é…ä¿¡æœŸé–“ â†’ extraction_period]
    MapRow --> M5[å¯¾è±¡è€… â†’ attribute<br/>æ–‡å­—åˆ—å¤‰æ›]
    MapRow --> M6[æ¤œçŸ¥å›æ•° â†’ detection_count<br/>æ•°å€¤å¤‰æ›]
    MapRow --> M7[æ¤œçŸ¥æ™‚é–“ â†’ detection_time_start/end]
    MapRow --> M8[æ»åœ¨æ™‚é–“ â†’ stay_time<br/>æ–‡å­—åˆ—å¤‰æ›]
    MapRow --> M9[Adsã‚¢ã‚«ã‚¦ãƒ³ãƒˆID â†’ ads_account_id]
    
    M1 --> ValidateRow[è¡Œãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³]
    M2 --> ValidateRow
    M3 --> ValidateRow
    M4 --> ValidateRow
    M5 --> ValidateRow
    M6 --> ValidateRow
    M7 --> ValidateRow
    M8 --> ValidateRow
    M9 --> ValidateRow
    
    ValidateRow --> CheckRowValid{ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³<br/>OK?}
    
    CheckRowValid -->|NG| ErrorRow[ã‚¨ãƒ©ãƒ¼åé›†:<br/>è¡Œç•ªå·ã¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¨˜éŒ²]
    
    CheckRowValid -->|OK| AddToArray[é…åˆ—ã«è¿½åŠ ]
    
    ErrorRow --> LoopStart
    AddToArray --> LoopStart
    
    LoopStart -->|å…¨è¡Œå®Œäº†| CheckTVerCTV[TVer(CTV)æ’ä»–åˆ¶å¾¡ãƒã‚§ãƒƒã‚¯]
    
    CheckTVerCTV --> CountCTV{TVer(CTV)ãŒ<br/>2ã¤ä»¥ä¸Š?}
    
    CountCTV -->|Yes| ErrorCTV[ã‚¨ãƒ©ãƒ¼åé›†:<br/>TVer(CTV)æ’ä»–åˆ¶å¾¡é•å]
    
    CountCTV -->|No| CheckDuplicateName[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåé‡è¤‡ãƒã‚§ãƒƒã‚¯]
    
    CheckDuplicateName --> HasDuplicate{é‡è¤‡ã‚ã‚Š?}
    
    HasDuplicate -->|Yes| ErrorDup[ã‚¨ãƒ©ãƒ¼åé›†:<br/>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåé‡è¤‡]
    
    HasDuplicate -->|No| Return([ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…åˆ—ã‚’è¿”å´])
    
    ErrorCTV --> Return
    ErrorDup --> Return
    
    style Start fill:#e1f0ff
    style Return fill:#e1f5e1
    style ErrorRow fill:#ffe1e1
    style ErrorCTV fill:#ffe1e1
    style ErrorDup fill:#ffe1e1
```

#### åœ°ç‚¹ãƒªã‚¹ãƒˆã‚·ãƒ¼ãƒˆã®ãƒ‘ãƒ¼ã‚¹

```mermaid
flowchart TD
    Start([åœ°ç‚¹ãƒªã‚¹ãƒˆã‚·ãƒ¼ãƒˆ]) --> ConvertJSON[JSONé…åˆ—ã«å¤‰æ›]
    
    ConvertJSON --> InitArray[ç©ºã®é…åˆ—ã‚’åˆæœŸåŒ–]
    
    InitArray --> CreateSegmentMap[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåâ†’<br/>ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒãƒƒãƒ—ä½œæˆ]
    
    CreateSegmentMap --> LoopStart{å„è¡Œã‚’<br/>ãƒ«ãƒ¼ãƒ—å‡¦ç†}
    
    LoopStart -->|è¡Œã”ã¨| CheckSample{ã‚µãƒ³ãƒ—ãƒ«è¡Œor<br/>ç©ºè¡Œ?}
    
    CheckSample -->|Yes| LoopStart
    
    CheckSample -->|No| GetSegmentName[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåã‚’å–å¾—]
    
    GetSegmentName --> FindSegment{ãƒãƒƒãƒ—ã‹ã‚‰<br/>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæ¤œç´¢}
    
    FindSegment -->|è¦‹ã¤ã‹ã‚‰ãªã„| ErrorNoSegment[ã‚¨ãƒ©ãƒ¼åé›†:<br/>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåãŒä¸æ˜]
    
    FindSegment -->|è¦‹ã¤ã‹ã£ãŸ| MapLocation[åœ°ç‚¹ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°]
    
    MapLocation --> L1[åœ°ç‚¹å â†’ poi_name]
    MapLocation --> L2[ä½æ‰€ â†’ address]
    MapLocation --> L3[ç·¯åº¦ â†’ latitude]
    MapLocation --> L4[çµŒåº¦ â†’ longitude]
    
    L1 --> ValidateLocation[åœ°ç‚¹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³]
    L2 --> ValidateLocation
    L3 --> ValidateLocation
    L4 --> ValidateLocation
    
    ValidateLocation --> CheckRequired{å¿…é ˆé …ç›®<br/>ãƒã‚§ãƒƒã‚¯}
    
    CheckRequired -->|NG| ErrorRequired[ã‚¨ãƒ©ãƒ¼åé›†:<br/>å¿…é ˆé …ç›®æœªå…¥åŠ›]
    
    CheckRequired -->|OK| CheckAddressOrLatLng{ä½æ‰€ OR<br/>ç·¯åº¦çµŒåº¦ã‚ã‚Š?}
    
    CheckAddressOrLatLng -->|No| ErrorNoLocation[ã‚¨ãƒ©ãƒ¼åé›†:<br/>ä½æ‰€ã¾ãŸã¯ç·¯åº¦çµŒåº¦ãŒå¿…è¦]
    
    CheckAddressOrLatLng -->|Yes| CheckLatLng{ç·¯åº¦çµŒåº¦ã®<br/>ç¯„å›²ãƒã‚§ãƒƒã‚¯}
    
    CheckLatLng -->|NG| ErrorRange[ã‚¨ãƒ©ãƒ¼åé›†:<br/>ç·¯åº¦çµŒåº¦ã®ç¯„å›²å¤–]
    
    CheckLatLng -->|OK| CreateLocation[PoiInfoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ]
    
    CreateLocation --> AttachSegmentIndex[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’<br/>ç´ä»˜ã‘]
    
    AttachSegmentIndex --> AddToArray[é…åˆ—ã«è¿½åŠ ]
    
    ErrorNoSegment --> LoopStart
    ErrorRequired --> LoopStart
    ErrorNoLocation --> LoopStart
    ErrorRange --> LoopStart
    AddToArray --> LoopStart
    
    LoopStart -->|å…¨è¡Œå®Œäº†| Return([åœ°ç‚¹é…åˆ—ã‚’è¿”å´])
    
    style Start fill:#e1f0ff
    style Return fill:#e1f5e1
    style ErrorNoSegment fill:#ffe1e1
    style ErrorRequired fill:#ffe1e1
    style ErrorNoLocation fill:#ffe1e1
    style ErrorRange fill:#ffe1e1
```

---

## ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

### å®Œå…¨ãªã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€œç™»éŒ²ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

```mermaid
sequenceDiagram
    actor User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant UI as UI<br/>(BulkImport.tsx)
    participant Parser as Excel Parser<br/>(excelBulkParser.ts)
    participant Validator as Validator
    participant Mapper as Data Mapper
    participant API as API Layer
    participant DB as Database

    User->>UI: Excelãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    activate UI
    UI->>UI: ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±è¡¨ç¤º
    
    User->>UI: ã€Œå†…å®¹ã‚’ç¢ºèªã€ã‚¯ãƒªãƒƒã‚¯
    UI->>Parser: parseExcelFile(file)
    activate Parser
    
    Parser->>Parser: ArrayBufferã¨ã—ã¦èª­ã¿è¾¼ã¿
    Parser->>Parser: XLSX.read(buffer)
    
    Parser->>Parser: å¿…é ˆã‚·ãƒ¼ãƒˆå­˜åœ¨ç¢ºèª
    
    alt ã‚·ãƒ¼ãƒˆä¸è¶³
        Parser-->>UI: Error: å¿…é ˆã‚·ãƒ¼ãƒˆãªã—
        UI->>User: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    else ã‚·ãƒ¼ãƒˆå®Œå‚™
        Parser->>Parser: æ¡ˆä»¶æƒ…å ±ã‚·ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚¹
        Parser->>Parser: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¨­å®šã‚·ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚¹
        Parser->>Parser: åœ°ç‚¹ãƒªã‚¹ãƒˆã‚·ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚¹
        
        Parser->>Validator: validate(parsedData)
        activate Validator
        
        Validator->>Validator: æ¡ˆä»¶æƒ…å ±ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        Validator->>Validator: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¨­å®šãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        Validator->>Validator: åœ°ç‚¹ãƒªã‚¹ãƒˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        Validator->>Validator: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
        
        Validator-->>Parser: ValidationResult
        deactivate Validator
        
        Parser-->>UI: ParseResult + Errors
        deactivate Parser
        
        alt ã‚¨ãƒ©ãƒ¼ã‚ã‚Š
            UI->>User: ã‚¨ãƒ©ãƒ¼ãƒªã‚¹ãƒˆè¡¨ç¤º
            Note over User,UI: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒExcelã‚’ä¿®æ­£
            User->>UI: ä¿®æ­£ç‰ˆã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        else ã‚¨ãƒ©ãƒ¼ãªã—
            UI->>User: ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢è¡¨ç¤º
            Note over User,UI: æ¡ˆä»¶1ä»¶<br/>ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ2ä»¶<br/>åœ°ç‚¹5ä»¶
            
            User->>UI: ã€Œç™»éŒ²ã™ã‚‹ã€ã‚¯ãƒªãƒƒã‚¯
            
            UI->>Mapper: mapToSchema(parseResult)
            activate Mapper
            
            Mapper->>Mapper: Projectä½œæˆ
            Mapper->>Mapper: Segmentä½œæˆï¼ˆè¤‡æ•°ï¼‰
            Mapper->>Mapper: PoiInfoä½œæˆï¼ˆè¤‡æ•°ï¼‰
            Mapper->>Mapper: IDã®è‡ªå‹•ç”Ÿæˆ
            Mapper->>Mapper: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—è¿½åŠ 
            
            Mapper-->>UI: MappedData
            deactivate Mapper
            
            UI->>API: bulkCreate(mappedData)
            activate API
            
            API->>DB: INSERT Project
            activate DB
            DB-->>API: ProjectID
            
            loop ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨
                API->>DB: INSERT Segment
                DB-->>API: SegmentID
                
                loop åœ°ç‚¹ã”ã¨
                    API->>DB: INSERT PoiInfo
                    DB-->>API: Success
                end
            end
            
            deactivate DB
            
            API-->>UI: BulkCreateResult
            deactivate API
            
            UI->>User: æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
            UI->>UI: æ¡ˆä»¶ä¸€è¦§ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
        end
    end
    
    deactivate UI
```

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

```mermaid
sequenceDiagram
    actor User as ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant UI as UI
    participant Parser as Parser
    participant Validator as Validator
    participant ErrorHandler as Error Handler

    User->>UI: Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    UI->>Parser: parseExcelFile(file)
    
    alt ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼
        Parser->>ErrorHandler: ParserError
        ErrorHandler->>ErrorHandler: ã‚¨ãƒ©ãƒ¼åˆ†é¡ãƒ»æ•´å½¢
        ErrorHandler-->>UI: FormattedError
        UI->>User: ã€ã‚¨ãƒ©ãƒ¼ã€‘<br/>ã‚·ãƒ¼ãƒˆæ§‹é€ ãŒä¸æ­£ã§ã™
        
    else ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
        Parser->>Validator: validate(data)
        Validator->>Validator: å„ç¨®ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
        
        Validator->>ErrorHandler: ValidationErrors[]
        ErrorHandler->>ErrorHandler: ã‚¨ãƒ©ãƒ¼é›†ç´„<br/>å„ªå…ˆåº¦ä»˜ã‘
        ErrorHandler->>ErrorHandler: ä¿®æ­£ææ¡ˆç”Ÿæˆ
        ErrorHandler-->>UI: ErrorReport
        
        UI->>User: ã€ã‚¨ãƒ©ãƒ¼ä¸€è¦§ã€‘<br/>3ä»¶ã®ã‚¨ãƒ©ãƒ¼
        
        loop ã‚¨ãƒ©ãƒ¼ã”ã¨
            UI->>User: ã‚¨ãƒ©ãƒ¼è©³ç´°è¡¨ç¤º<br/>- ã‚»ã‚¯ã‚·ãƒ§ãƒ³<br/>- è¡Œç•ªå·<br/>- å•é¡Œå†…å®¹<br/>- ä¿®æ­£ææ¡ˆ
        end
        
    else æ¥­å‹™ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼
        Validator->>ErrorHandler: BusinessRuleError
        ErrorHandler->>ErrorHandler: ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«<br/>é•åã®èª¬æ˜ç”Ÿæˆ
        ErrorHandler-->>UI: RuleViolationError
        
        UI->>User: ã€è­¦å‘Šã€‘<br/>TVer(CTV)ã¯ä»–ã®é…ä¿¡å…ˆã¨ä½µç”¨ä¸å¯
        
    else æˆåŠŸ
        Validator-->>UI: ValidationSuccess
        UI->>User: ã€æˆåŠŸã€‘<br/>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
    end
```

---

## çŠ¶æ…‹é·ç§»å›³

### ä¸€æ‹¬ç™»éŒ²æ©Ÿèƒ½ã®çŠ¶æ…‹é·ç§»

```mermaid
stateDiagram-v2
    [*] --> åˆæœŸçŠ¶æ…‹
    
    åˆæœŸçŠ¶æ…‹ --> ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆ: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDL
    ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆ --> åˆæœŸçŠ¶æ…‹: åˆ¥ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
    
    åˆæœŸçŠ¶æ…‹ --> ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆ: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ¸ˆ --> ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆ: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    
    ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆ --> è§£æä¸­: ã€Œå†…å®¹ã‚’ç¢ºèªã€ã‚¯ãƒªãƒƒã‚¯
    
    è§£æä¸­ --> ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³NG
    è§£æä¸­ --> ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³OK
    
    ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ --> åˆæœŸçŠ¶æ…‹: åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ --> ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ¸ˆ: ä¿®æ­£ç‰ˆã‚’é¸æŠ
    
    ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º --> ç™»éŒ²ä¸­: ã€Œç™»éŒ²ã™ã‚‹ã€ã‚¯ãƒªãƒƒã‚¯
    ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º --> åˆæœŸçŠ¶æ…‹: ã‚­ãƒ£ãƒ³ã‚»ãƒ«
    
    ç™»éŒ²ä¸­ --> ç™»éŒ²æˆåŠŸ: DBç™»éŒ²å®Œäº†
    ç™»éŒ²ä¸­ --> ç™»éŒ²å¤±æ•—: DBç™»éŒ²ã‚¨ãƒ©ãƒ¼
    
    ç™»éŒ²æˆåŠŸ --> [*]: æ¡ˆä»¶ä¸€è¦§ã¸
    ç™»éŒ²å¤±æ•— --> ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
    
    note right of åˆæœŸçŠ¶æ…‹
        - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆDLãƒœã‚¿ãƒ³è¡¨ç¤º
        - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒœã‚¿ãƒ³è¡¨ç¤º
    end note
    
    note right of è§£æä¸­
        - ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        - ãƒ‘ãƒ¼ã‚¹å®Ÿè¡Œ
        - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    end note
    
    note right of ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        - æ¡ˆä»¶: 1ä»¶
        - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ: Nä»¶
        - åœ°ç‚¹: Mä»¶
        - è©³ç´°ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    end note
    
    note right of ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
        - ã‚¨ãƒ©ãƒ¼ä»¶æ•°è¡¨ç¤º
        - ã‚¨ãƒ©ãƒ¼è©³ç´°ãƒªã‚¹ãƒˆ
        - ä¿®æ­£ææ¡ˆ
    end note
```

### ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã®çŠ¶æ…‹é·ç§»

```mermaid
stateDiagram-v2
    [*] --> ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ
    
    ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ --> ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
    
    ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­ --> èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: FileReader Error
    ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­ --> ãƒ‘ãƒ¼ã‚¹ä¸­: èª­ã¿è¾¼ã¿å®Œäº†
    
    èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼ --> ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ: ãƒªãƒˆãƒ©ã‚¤
    
    ãƒ‘ãƒ¼ã‚¹ä¸­ --> ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: XLSX.read Error
    ãƒ‘ãƒ¼ã‚¹ä¸­ --> ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­: ãƒ‘ãƒ¼ã‚¹æˆåŠŸ
    
    ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ --> ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ: ãƒªãƒˆãƒ©ã‚¤
    
    ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ --> ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ãƒ«ãƒ¼ãƒ«é•å
    ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ --> æ¤œè¨¼å®Œäº†: ã™ã¹ã¦OK
    
    ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ --> ãƒ•ã‚¡ã‚¤ãƒ«æœªé¸æŠ: ä¿®æ­£ç‰ˆã‚’é¸æŠ
    
    æ¤œè¨¼å®Œäº† --> ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°ä¸­: ãƒãƒƒãƒ”ãƒ³ã‚°é–‹å§‹
    
    ãƒ‡ãƒ¼ã‚¿ãƒãƒƒãƒ”ãƒ³ã‚°ä¸­ --> ãƒãƒƒãƒ”ãƒ³ã‚°å®Œäº†: å¤‰æ›å®Œäº†
    
    ãƒãƒƒãƒ”ãƒ³ã‚°å®Œäº† --> [*]: ç™»éŒ²å¯èƒ½çŠ¶æ…‹
```

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ•ãƒ­ãƒ¼

### ã‚¨ãƒ©ãƒ¼æ¤œå‡ºã€œå›å¾©ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ã‚¨ãƒ©ãƒ¼æ¤œå‡º]) --> Classify{ã‚¨ãƒ©ãƒ¼åˆ†é¡}
    
    Classify -->|æ§‹é€ ã‚¨ãƒ©ãƒ¼| StructError[ã‚·ãƒ¼ãƒˆä¸è¶³/å½¢å¼ä¸æ­£]
    Classify -->|ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼| DataError[å¿…é ˆé …ç›®æœªå…¥åŠ›/å‹ä¸æ­£]
    Classify -->|ãƒ«ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼| RuleError[ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«é•å]
    
    StructError --> StructSeverity{é‡å¤§åº¦}
    StructSeverity -->|Critical| Block1[ç™»éŒ²ãƒ–ãƒ­ãƒƒã‚¯]
    
    DataError --> DataSeverity{é‡å¤§åº¦}
    DataSeverity -->|Critical| Block2[ç™»éŒ²ãƒ–ãƒ­ãƒƒã‚¯]
    DataSeverity -->|Warning| Warn1[è­¦å‘Šè¡¨ç¤º]
    
    RuleError --> RuleSeverity{é‡å¤§åº¦}
    RuleSeverity -->|Critical| Block3[ç™»éŒ²ãƒ–ãƒ­ãƒƒã‚¯]
    RuleSeverity -->|Warning| Warn2[è­¦å‘Šè¡¨ç¤º]
    
    Block1 --> ShowError[è©³ç´°ã‚¨ãƒ©ãƒ¼è¡¨ç¤º]
    Block2 --> ShowError
    Block3 --> ShowError
    
    ShowError --> GenerateSuggestion[ä¿®æ­£ææ¡ˆç”Ÿæˆ]
    
    GenerateSuggestion --> DisplayError[UIä¸Šã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤º]
    
    DisplayError --> UserAction{ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ}
    
    UserAction -->|ä¿®æ­£| FixData[ãƒ‡ãƒ¼ã‚¿ä¿®æ­£]
    UserAction -->|ã‚­ãƒ£ãƒ³ã‚»ãƒ«| Cancel([å‡¦ç†ä¸­æ–­])
    
    FixData --> Reupload[å†ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰]
    Reupload --> Start
    
    Warn1 --> ShowWarning[è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º]
    Warn2 --> ShowWarning
    
    ShowWarning --> UserChoice{ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ}
    
    UserChoice -->|ç„¡è¦–ã—ã¦ç¶šè¡Œ| Proceed[ç™»éŒ²ç¶šè¡Œ]
    UserChoice -->|ä¿®æ­£| FixData
    
    Proceed --> Success([ç™»éŒ²æˆåŠŸ])
    
    style Start fill:#ffe1e1
    style Cancel fill:#aaa
    style Success fill:#e1f5e1
    style Block1 fill:#ff6b6b
    style Block2 fill:#ff6b6b
    style Block3 fill:#ff6b6b
    style Warn1 fill:#ffd93d
    style Warn2 fill:#ffd93d
```

### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ]) --> Collect[ã‚¨ãƒ©ãƒ¼æƒ…å ±åé›†]
    
    Collect --> Info1[ã‚»ã‚¯ã‚·ãƒ§ãƒ³å<br/>PROJECT/SEGMENT/LOCATION]
    Collect --> Info2[è¡Œç•ªå·<br/>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã‚‹è¡Œç•ªå·]
    Collect --> Info3[ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å<br/>è¡¨ç¤ºå]
    Collect --> Info4[ã‚¨ãƒ©ãƒ¼å†…å®¹<br/>ä½•ãŒå•é¡Œã‹]
    Collect --> Info5[å…¥åŠ›å€¤<br/>å•é¡Œã®ã‚ã‚‹å€¤]
    
    Info1 --> Build[ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹ç¯‰]
    Info2 --> Build
    Info3 --> Build
    Info4 --> Build
    Info5 --> Build
    
    Build --> Translate[æŠ€è¡“ç”¨èªã‚’<br/>ã‚ã‹ã‚Šã‚„ã™ã„æ—¥æœ¬èªã«å¤‰æ›]
    
    Translate --> T1[media_id â†’ é…ä¿¡å…ˆ]
    Translate --> T2[designated_radius â†’ é…ä¿¡ç¯„å›²]
    Translate --> T3[attribute â†’ å¯¾è±¡è€…]
    
    T1 --> AddContext[ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ ]
    T2 --> AddContext
    T3 --> AddContext
    
    AddContext --> WhyError[ãªãœã‚¨ãƒ©ãƒ¼ã‹èª¬æ˜]
    WhyError --> HowFix[ã©ã†ä¿®æ­£ã™ã‚‹ã‹ææ¡ˆ]
    
    HowFix --> Format[ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ•´å½¢]
    
    Format --> Example[ä¿®æ­£ä¾‹ã®æç¤º<br/>å¯èƒ½ãªå ´åˆ]
    
    Example --> Output([ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡ºåŠ›])
    
    style Start fill:#ffe1e1
    style Output fill:#e1f0ff
```

---

## ãƒ‡ãƒ¼ã‚¿å¤‰æ›ãƒ•ãƒ­ãƒ¼

### ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³å€¤ã®ãƒãƒƒãƒ”ãƒ³ã‚°

```mermaid
flowchart LR
    subgraph Excel [Excelè¡¨ç¤ºå€¤]
        E1[UNIVERSE]
        E2[TVer ã‚¹ãƒãƒ›]
        E3[TVer ãƒ†ãƒ¬ãƒ“]
        E4[æ¤œçŸ¥ã•ã‚ŒãŸäºº]
        E5[å±…ä½è€…]
        E6[å‹¤å‹™è€…]
        E7[1ãƒ¶æœˆ]
        E8[500m]
        E9[3å›ä»¥ä¸Š]
    end
    
    subgraph Mapper [ãƒãƒƒãƒ”ãƒ³ã‚°é–¢æ•°]
        M1[mapMediaId]
        M2[mapAttribute]
        M3[mapPeriod]
        M4[mapRadius]
        M5[mapDetectionCount]
    end
    
    subgraph Internal [å†…éƒ¨å€¤]
        I1[universe]
        I2[tver_sp]
        I3[tver_ctv]
        I4[detector]
        I5[resident]
        I6[worker]
        I7[1month]
        I8[500m]
        I9[3]
    end
    
    E1 --> M1 --> I1
    E2 --> M1 --> I2
    E3 --> M1 --> I3
    
    E4 --> M2 --> I4
    E5 --> M2 --> I5
    E6 --> M2 --> I6
    
    E7 --> M3 --> I7
    E8 --> M4 --> I8
    E9 --> M5 --> I9
    
    style Excel fill:#e1f0ff
    style Mapper fill:#fff4e1
    style Internal fill:#e1f5e1
```

### ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹ç¯‰ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ãƒ‘ãƒ¼ã‚¹å®Œäº†ãƒ‡ãƒ¼ã‚¿]) --> Project[æ¡ˆä»¶ãƒ‡ãƒ¼ã‚¿]
    Start --> Segments[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆé…åˆ—]
    Start --> Locations[åœ°ç‚¹é…åˆ—]
    
    Project --> ProjID[project_idç”Ÿæˆ<br/>PRJ-timestamp]
    ProjID --> ProjTime[_register_datetimeè¿½åŠ <br/>ç¾åœ¨æ™‚åˆ»]
    ProjTime --> ProjStatus[project_statusè¨­å®š<br/>æº–å‚™ä¸­]
    ProjStatus --> ProjObj[Projectã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå®Œæˆ]
    
    Segments --> SegLoop{ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨}
    
    SegLoop -->|å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ| SegID[segment_idç”Ÿæˆ<br/>SEG-timestamp-index]
    SegID --> SegProjID[project_idç´ä»˜ã‘]
    SegProjID --> SegTime[segment_registered_atè¿½åŠ ]
    SegTime --> SegStatus[ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆæœŸåŒ–<br/>location_request_status: not_requested<br/>data_link_status: before_request]
    SegStatus --> SegCommon[å…±é€šæ¡ä»¶è¨­å®š<br/>designated_radius<br/>extraction_period<br/>attribute<br/>detection_count<br/>...]
    SegCommon --> SegObj[Segmentã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå®Œæˆ]
    
    SegObj --> SegLoop
    
    SegLoop -->|å…¨å®Œäº†| SegArray[Segmenté…åˆ—å®Œæˆ]
    
    Locations --> LocLoop{åœ°ç‚¹ã”ã¨}
    
    LocLoop -->|å„åœ°ç‚¹| LocSegment[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹<br/>ã‹ã‚‰ç´ä»˜ã‘]
    LocSegment --> LocID[poi_idç”Ÿæˆ<br/>POI-timestamp-index]
    LocID --> LocProjID[project_idç´ä»˜ã‘]
    LocProjID --> LocSegID[segment_idç´ä»˜ã‘]
    LocSegID --> LocType[poi_typeè¨­å®š<br/>manual]
    LocType --> LocInherit[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå…±é€šæ¡ä»¶ç¶™æ‰¿<br/>å¾Œæ–¹äº’æ›æ€§ã®ãŸã‚]
    LocInherit --> LocTime[createdè¿½åŠ <br/>ç¾åœ¨æ™‚åˆ»]
    LocTime --> LocObj[PoiInfoã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå®Œæˆ]
    
    LocObj --> LocLoop
    
    LocLoop -->|å…¨å®Œäº†| LocArray[PoiInfoé…åˆ—å®Œæˆ]
    
    ProjObj --> Bundle[ã™ã¹ã¦ã‚’ãƒãƒ³ãƒ‰ãƒ«]
    SegArray --> Bundle
    LocArray --> Bundle
    
    Bundle --> Final([ç™»éŒ²æº–å‚™å®Œäº†])
    
    style Start fill:#e1f0ff
    style Final fill:#e1f5e1
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç™»éŒ²ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([ç™»éŒ²é–‹å§‹]) --> BeginTx[ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹]
    
    BeginTx --> InsertProj[æ¡ˆä»¶ã‚’INSERT]
    
    InsertProj --> CheckProj{æˆåŠŸ?}
    CheckProj -->|No| Rollback1[ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯]
    
    CheckProj -->|Yes| LoopSeg{ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã”ã¨}
    
    LoopSeg -->|å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ| InsertSeg[ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’INSERT]
    
    InsertSeg --> CheckSeg{æˆåŠŸ?}
    CheckSeg -->|No| Rollback2[ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯]
    
    CheckSeg -->|Yes| GetLocs[ã“ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®<br/>åœ°ç‚¹ã‚’å–å¾—]
    
    GetLocs --> LoopLoc{åœ°ç‚¹ã”ã¨}
    
    LoopLoc -->|å„åœ°ç‚¹| InsertLoc[åœ°ç‚¹ã‚’INSERT]
    
    InsertLoc --> CheckLoc{æˆåŠŸ?}
    CheckLoc -->|No| Rollback3[ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯]
    
    CheckLoc -->|Yes| LoopLoc
    
    LoopLoc -->|å®Œäº†| LoopSeg
    
    LoopSeg -->|å…¨å®Œäº†| Commit[ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³<br/>ã‚³ãƒŸãƒƒãƒˆ]
    
    Commit --> Success([ç™»éŒ²æˆåŠŸ])
    
    Rollback1 --> Error([ç™»éŒ²å¤±æ•—])
    Rollback2 --> Error
    Rollback3 --> Error
    
    style Start fill:#e1f0ff
    style Success fill:#e1f5e1
    style Error fill:#ffe1e1
    style Rollback1 fill:#ff6b6b
    style Rollback2 fill:#ff6b6b
    style Rollback3 fill:#ff6b6b
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãƒ•ãƒ­ãƒ¼

### å¤§é‡ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ•ãƒ­ãƒ¼

```mermaid
flowchart TD
    Start([å¤§é‡ãƒ‡ãƒ¼ã‚¿æ¤œå‡º<br/>åœ°ç‚¹1000ä»¶ä»¥ä¸Š]) --> Chunk[ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒ£ãƒ³ã‚¯åˆ†å‰²<br/>100ä»¶ãšã¤]
    
    Chunk --> Progress[ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼åˆæœŸåŒ–]
    
    Progress --> LoopChunk{ãƒãƒ£ãƒ³ã‚¯ã”ã¨}
    
    LoopChunk -->|å„ãƒãƒ£ãƒ³ã‚¯| ProcessChunk[100ä»¶ã‚’å‡¦ç†]
    
    ProcessChunk --> UpdateProgress[ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°<br/>XX%å®Œäº†]
    
    UpdateProgress --> YieldUI[UIã‚¹ãƒ¬ãƒƒãƒ‰ã«<br/>åˆ¶å¾¡ã‚’æˆ»ã™<br/>requestAnimationFrame]
    
    YieldUI --> LoopChunk
    
    LoopChunk -->|å…¨å®Œäº†| Complete[100%å®Œäº†]
    
    Complete --> End([å‡¦ç†å®Œäº†])
    
    style Start fill:#fff4e1
    style End fill:#e1f5e1
```

---

## ä»˜éŒ²

### ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ä¸€è¦§

| ã‚³ãƒ¼ãƒ‰ | åˆ†é¡ | èª¬æ˜ |
|-------|------|------|
| E001 | æ§‹é€  | å¿…é ˆã‚·ãƒ¼ãƒˆãŒå­˜åœ¨ã—ãªã„ |
| E002 | æ§‹é€  | ã‚·ãƒ¼ãƒˆåãŒä¸æ­£ |
| E003 | æ§‹é€  | ãƒ˜ãƒƒãƒ€ãƒ¼è¡ŒãŒä¸æ­£ |
| E101 | æ¡ˆä»¶ | åºƒå‘Šä¸»åãŒæœªå…¥åŠ› |
| E102 | æ¡ˆä»¶ | è¨´æ±‚å†…å®¹ãŒæœªå…¥åŠ› |
| E103 | æ¡ˆä»¶ | é…ä¿¡é–‹å§‹æ—¥ãŒä¸æ­£ |
| E104 | æ¡ˆä»¶ | é…ä¿¡çµ‚äº†æ—¥ãŒé–‹å§‹æ—¥ã‚ˆã‚Šå‰ |
| E201 | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåãŒé‡è¤‡ |
| E202 | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ | é…ä¿¡å…ˆãŒæœªé¸æŠ |
| E203 | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ | TVer(CTV)ãŒè¤‡æ•°å­˜åœ¨ |
| E204 | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ | é…ä¿¡ç¯„å›²ãŒæœªé¸æŠ |
| E301 | åœ°ç‚¹ | åœ°ç‚¹åãŒæœªå…¥åŠ› |
| E302 | åœ°ç‚¹ | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆåãŒä¸æ˜ |
| E303 | åœ°ç‚¹ | ä½æ‰€ã¨ç·¯åº¦çµŒåº¦ãŒä¸¡æ–¹æœªå…¥åŠ› |
| E304 | åœ°ç‚¹ | ç·¯åº¦çµŒåº¦ã®ç¯„å›²å¤– |

---

**END OF DOCUMENT**
