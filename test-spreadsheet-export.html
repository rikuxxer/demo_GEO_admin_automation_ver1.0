<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ›¸ãå‡ºã—ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        textarea {
            height: 200px;
            font-family: monospace;
        }
        button {
            background-color: #5b5fff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #4a4aff;
        }
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .help-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ›¸ãå‡ºã—ãƒ†ã‚¹ãƒˆ</h1>
        
        <div class="form-group">
            <label for="backendUrl">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URL *</label>
            <input type="text" id="backendUrl" placeholder="https://universegeo-backend-xxx.run.app" value="">
            <div class="help-text">
                ä¾‹: https://universegeo-backend-223225164238.asia-northeast1.run.app<br>
                <strong>é‡è¦:</strong> URLã‚’ç›´æ¥ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ã€JSONãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„
            </div>
            <button onclick="testBackendConnection()" style="background-color: #28a745; margin-top: 10px;">ğŸ” ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
            <div class="help-text" style="margin-top: 5px;">ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™</div>
        </div>

        <div class="form-group">
            <label for="testData">ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ (JSON)</label>
            <textarea id="testData">{
  "rows": [
    {
      "åŠå¾„": "500",
      "brand_name": "ãƒ†ã‚¹ãƒˆãƒ–ãƒ©ãƒ³ãƒ‰",
      "poi_id": "TEST-001",
      "poi_name": "ãƒ†ã‚¹ãƒˆåœ°ç‚¹1",
      "latitude": "35.6812",
      "longitude": "139.7671",
      "prefecture": "æ±äº¬éƒ½",
      "city": "åƒä»£ç”°åŒº",
      "setting_flag": "1",
      "created": "2024-01-01"
    }
  ]
}</textarea>
            <div class="help-text">ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <button id="testBtn" onclick="testExport()">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="generateTestData()">ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ</button>
        <button onclick="clearResult()">çµæœã‚’ã‚¯ãƒªã‚¢</button>

        <div id="result" class="result"></div>
    </div>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã‚’è‡ªå‹•æ¤œå‡ºï¼ˆå¯èƒ½ãªå ´åˆï¼‰
        window.addEventListener('DOMContentLoaded', () => {
            // ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã‚’è©¦ã¿ã‚‹ï¼ˆé–‹ç™ºç’°å¢ƒã®å ´åˆï¼‰
            const envUrl = localStorage.getItem('backendUrl');
            if (envUrl) {
                document.getElementById('backendUrl').value = envUrl;
            }
        });

        function generateTestData() {
            const timestamp = Date.now();
            const date = new Date().toISOString().split('T')[0];
            
            const testData = {
                rows: [
                    {
                        åŠå¾„: "500",
                        brand_name: "ãƒ†ã‚¹ãƒˆãƒ–ãƒ©ãƒ³ãƒ‰",
                        poi_id: `TEST-${timestamp}`,
                        poi_name: "ãƒ†ã‚¹ãƒˆåœ°ç‚¹ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰",
                        latitude: "35.6812",
                        longitude: "139.7671",
                        prefecture: "æ±äº¬éƒ½",
                        city: "åƒä»£ç”°åŒº",
                        setting_flag: "1",
                        created: date
                    },
                    {
                        åŠå¾„: "300",
                        brand_name: "ãƒ†ã‚¹ãƒˆãƒ–ãƒ©ãƒ³ãƒ‰",
                        poi_id: `TEST-${timestamp + 1}`,
                        poi_name: "ãƒ†ã‚¹ãƒˆåœ°ç‚¹2ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰",
                        latitude: "35.6896",
                        longitude: "139.6917",
                        prefecture: "æ±äº¬éƒ½",
                        city: "æ–°å®¿åŒº",
                        setting_flag: "1",
                        created: date
                    }
                ]
            };
            
            document.getElementById('testData').value = JSON.stringify(testData, null, 2);
        }

        async function testExport() {
            const backendUrl = document.getElementById('backendUrl').value.trim();
            const testDataText = document.getElementById('testData').value.trim();
            const resultDiv = document.getElementById('result');
            const testBtn = document.getElementById('testBtn');

            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            if (!backendUrl) {
                showResult('error', 'âŒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            if (!testDataText) {
                showResult('error', 'âŒ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            let testData;
            try {
                testData = JSON.parse(testDataText);
            } catch (e) {
                showResult('error', `âŒ JSONã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“: ${e.message}`);
                return;
            }

            if (!testData.rows || !Array.isArray(testData.rows)) {
                showResult('error', 'âŒ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã« "rows" é…åˆ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“');
                return;
            }

            // URLã®æ­£è¦åŒ–ï¼ˆæœ«å°¾ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’å‰Šé™¤ï¼‰
            const normalizedUrl = backendUrl.replace(/\/$/, '');
            const apiUrl = `${normalizedUrl}/api/sheets/export`;

            // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã‚’ä¿å­˜
            localStorage.setItem('backendUrl', normalizedUrl);

            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            testBtn.disabled = true;
            testBtn.textContent = 'é€ä¿¡ä¸­...';

            // çµæœã‚’ã‚¯ãƒªã‚¢
            resultDiv.style.display = 'none';

            try {
                showResult('info', 'ğŸ“¤ APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ä¸­...\n\n' + 
                    `URL: ${apiUrl}\n` +
                    `ãƒ‡ãƒ¼ã‚¿ä»¶æ•°: ${testData.rows.length}ä»¶\n` +
                    `Origin: ${window.location.origin || 'null (file://)'}\n` +
                    `Protocol: ${window.location.protocol}`);

                // ã¾ãšOPTIONSãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆpreflightï¼‰ã‚’ãƒ†ã‚¹ãƒˆ
                console.log('ğŸ” Preflight (OPTIONS) ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ä¸­...');
                try {
                    const preflightResponse = await fetch(apiUrl, {
                        method: 'OPTIONS',
                        headers: {
                            'Origin': window.location.origin || 'null',
                            'Access-Control-Request-Method': 'POST',
                            'Access-Control-Request-Headers': 'content-type',
                        },
                        mode: 'cors',
                    });
                    console.log('âœ… PreflightæˆåŠŸ:', {
                        status: preflightResponse.status,
                        headers: Object.fromEntries(preflightResponse.headers.entries())
                    });
                } catch (preflightError) {
                    console.error('âŒ Preflightå¤±æ•—:', preflightError);
                    showResult('error', 
                        `âŒ Preflight (OPTIONS) ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ\n\n` +
                        `ã‚¨ãƒ©ãƒ¼: ${preflightError.message}\n\n` +
                        `ã“ã‚Œã¯CORSè¨­å®šã®å•é¡Œã§ã‚ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚\n` +
                        `ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå†ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚`
                    );
                    return;
                }

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(testData),
                    mode: 'cors', // CORSãƒ¢ãƒ¼ãƒ‰ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    let errorData;
                    try {
                        errorData = JSON.parse(errorText);
                    } catch {
                        errorData = { error: errorText };
                    }
                    throw new Error(`HTTP ${response.status}: ${errorData.error || errorData.message || errorText}`);
                }

                const responseData = await response.json();

                if (response.ok && responseData.success) {
                    showResult('success', 
                        `âœ… æˆåŠŸï¼\n\n` +
                        `ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${responseData.message}\n` +
                        `è¿½åŠ è¡Œæ•°: ${responseData.rowsAdded || testData.rows.length}ä»¶\n\n` +
                        `æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:\n` +
                        `1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ã„ã¦ã€ãƒ‡ãƒ¼ã‚¿ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„\n` +
                        `2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ã‚‚ç¢ºèªã—ã¦ãã ã•ã„`,
                        responseData
                    );
                } else {
                    showResult('error', 
                        `âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ\n\n` +
                        `HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}\n` +
                        `ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${responseData.message || responseData.error || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}`,
                        responseData
                    );
                }
            } catch (error) {
                let errorDetails = `âŒ ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼\n\n`;
                errorDetails += `ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${error.message}\n\n`;
                
                // ã‚ˆã‚Šè©³ç´°ãªã‚¨ãƒ©ãƒ¼æƒ…å ±
                if (error.name === 'TypeError' && error.message.includes('Failed to fetch')) {
                    errorDetails += `ğŸ” è©³ç´°åˆ†æ:\n`;
                    errorDetails += `- ã“ã‚Œã¯é€šå¸¸ã€CORSã‚¨ãƒ©ãƒ¼ã¾ãŸã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã§ã™\n`;
                    errorDetails += `- ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰> Networkã‚¿ãƒ–ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„\n\n`;
                    errorDetails += `ğŸ“‹ ç¢ºèªäº‹é …:\n`;
                    errorDetails += `1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLãŒæ­£ã—ã„ã‹: ${apiUrl}\n`;
                    errorDetails += `2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ï¼ˆURLã‚’ç›´æ¥ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ç¢ºèªï¼‰\n`;
                    errorDetails += `3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå†ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ï¼ˆGitHub Actionsã‚’ç¢ºèªï¼‰\n`;
                    errorDetails += `4. CORSè¨­å®šãŒæ­£ã—ã„ã‹ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ­ã‚°ã‚’ç¢ºèªï¼‰\n`;
                    errorDetails += `5. Cloud Runã®èªè¨¼è¨­å®šï¼ˆ--allow-unauthenticatedãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ï¼‰\n\n`;
                    errorDetails += `ğŸ’¡ ãƒ‡ãƒãƒƒã‚°æ–¹æ³•:\n`;
                    errorDetails += `- ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰ã‚’é–‹ã\n`;
                    errorDetails += `- Networkã‚¿ãƒ–ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ç¢ºèª\n`;
                    errorDetails += `- å¤±æ•—ã—ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’ç¢ºèª\n`;
                    errorDetails += `- Consoleã‚¿ãƒ–ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª`;
                } else {
                    errorDetails += `ç¢ºèªäº‹é …:\n`;
                    errorDetails += `- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLãŒæ­£ã—ã„ã‹ç¢ºèª\n`;
                    errorDetails += `- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ç¢ºèª\n`;
                    errorDetails += `- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ${error.message}`;
                }
                
                showResult('error', errorDetails, {
                    name: error.name,
                    message: error.message,
                    stack: error.stack
                });
            } finally {
                // ãƒœã‚¿ãƒ³ã‚’å†æœ‰åŠ¹åŒ–
                testBtn.disabled = false;
                testBtn.textContent = 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ';
            }
        }

        function showResult(type, message, data = null) {
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';
            
            let content = message;
            if (data) {
                content += '\n\nè©³ç´°:\n' + JSON.stringify(data, null, 2);
            }
            
            resultDiv.innerHTML = `<pre>${content}</pre>`;
        }

        function clearResult() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'none';
        }

        async function testBackendConnection() {
            const backendUrl = document.getElementById('backendUrl').value.trim();
            const resultDiv = document.getElementById('result');

            if (!backendUrl) {
                showResult('error', 'âŒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            const normalizedUrl = backendUrl.replace(/\/$/, '');
            const healthUrl = `${normalizedUrl}/health`;
            const rootUrl = normalizedUrl;

            showResult('info', 'ğŸ” ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­...\n\n' + 
                `Health Check: ${healthUrl}\n` +
                `Root: ${rootUrl}\n` +
                `Origin: ${window.location.origin || 'null (file://)'}`);

            let testResults = [];

            // ãƒ†ã‚¹ãƒˆ1: Health check
            try {
                console.log('ğŸ” Health check ãƒ†ã‚¹ãƒˆä¸­...');
                const healthResponse = await fetch(healthUrl, {
                    method: 'GET',
                    mode: 'cors',
                });
                
                let healthData = null;
                if (healthResponse.ok) {
                    try {
                        healthData = await healthResponse.json();
                    } catch (e) {
                        healthData = { raw: await healthResponse.text() };
                    }
                }

                testResults.push({
                    name: 'Health Check',
                    url: healthUrl,
                    status: healthResponse.status,
                    statusText: healthResponse.statusText,
                    ok: healthResponse.ok,
                    data: healthData,
                    headers: Object.fromEntries(healthResponse.headers.entries())
                });
            } catch (error) {
                testResults.push({
                    name: 'Health Check',
                    url: healthUrl,
                    error: error.message,
                    errorName: error.name
                });
            }

            // ãƒ†ã‚¹ãƒˆ2: Root endpoint
            try {
                console.log('ğŸ” Root endpoint ãƒ†ã‚¹ãƒˆä¸­...');
                const rootResponse = await fetch(rootUrl, {
                    method: 'GET',
                    mode: 'cors',
                });
                
                let rootData = null;
                if (rootResponse.ok) {
                    try {
                        rootData = await rootResponse.json();
                    } catch (e) {
                        rootData = { raw: await rootResponse.text() };
                    }
                }

                testResults.push({
                    name: 'Root Endpoint',
                    url: rootUrl,
                    status: rootResponse.status,
                    statusText: rootResponse.statusText,
                    ok: rootResponse.ok,
                    data: rootData,
                    headers: Object.fromEntries(rootResponse.headers.entries())
                });
            } catch (error) {
                testResults.push({
                    name: 'Root Endpoint',
                    url: rootUrl,
                    error: error.message,
                    errorName: error.name
                });
            }

            // ãƒ†ã‚¹ãƒˆ3: OPTIONS (preflight)
            try {
                console.log('ğŸ” OPTIONS (preflight) ãƒ†ã‚¹ãƒˆä¸­...');
                const optionsResponse = await fetch(rootUrl, {
                    method: 'OPTIONS',
                    mode: 'cors',
                    headers: {
                        'Origin': window.location.origin || 'null',
                        'Access-Control-Request-Method': 'GET',
                    }
                });

                testResults.push({
                    name: 'OPTIONS (Preflight)',
                    url: rootUrl,
                    status: optionsResponse.status,
                    statusText: optionsResponse.statusText,
                    ok: optionsResponse.ok,
                    headers: Object.fromEntries(optionsResponse.headers.entries())
                });
            } catch (error) {
                testResults.push({
                    name: 'OPTIONS (Preflight)',
                    url: rootUrl,
                    error: error.message,
                    errorName: error.name
                });
            }

            // çµæœã‚’è¡¨ç¤º
            let result = 'ğŸ“‹ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æ¥ç¶šãƒ†ã‚¹ãƒˆçµæœ\n\n';
            let hasError = false;
            let hasSuccess = false;

            testResults.forEach((test, index) => {
                result += `${index + 1}. ${test.name}\n`;
                result += `   URL: ${test.url}\n`;
                
                if (test.error) {
                    hasError = true;
                    result += `   âŒ ã‚¨ãƒ©ãƒ¼: ${test.errorName} - ${test.error}\n`;
                } else {
                    result += `   ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${test.status} ${test.statusText}\n`;
                    if (test.ok) {
                        hasSuccess = true;
                        result += `   âœ… æˆåŠŸ\n`;
                        if (test.data) {
                            result += `   ãƒ¬ã‚¹ãƒãƒ³ã‚¹: ${JSON.stringify(test.data, null, 2)}\n`;
                        }
                    } else {
                        hasError = true;
                        result += `   âš ï¸ ã‚¨ãƒ©ãƒ¼ï¼ˆHTTP ${test.status}ï¼‰\n`;
                    }
                    
                    // CORSãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¢ºèª
                    if (test.headers) {
                        const corsHeaders = Object.keys(test.headers).filter(k => 
                            k.toLowerCase().includes('access-control')
                        );
                        if (corsHeaders.length > 0) {
                            result += `   CORSãƒ˜ãƒƒãƒ€ãƒ¼:\n`;
                            corsHeaders.forEach(header => {
                                result += `     ${header}: ${test.headers[header]}\n`;
                            });
                        } else {
                            // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã—ã¦ã„ã‚‹å ´åˆã€CORSã¯æ©Ÿèƒ½ã—ã¦ã„ã‚‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ã§èª­ã¿å–ã‚Œãªã„ã ã‘ï¼‰
                            if (test.ok) {
                                result += `   âœ… CORSã¯æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åˆ¶é™ã§ãƒ˜ãƒƒãƒ€ãƒ¼ã¯èª­ã¿å–ã‚Œã¾ã›ã‚“ï¼‰\n`;
                            } else {
                                result += `   âš ï¸ CORSãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“\n`;
                            }
                        }
                    }
                }
                result += `\n`;
            });

            // æ¨å¥¨äº‹é …
            result += `\nğŸ’¡ æ¨å¥¨äº‹é …:\n`;
            if (hasError) {
                result += `1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URLã‚’ç›´æ¥ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ç¢ºèª: ${rootUrl}\n`;
                result += `2. GitHub Actionsã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒå†ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª\n`;
                result += `3. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ï¼‰> Networkã‚¿ãƒ–ã§è©³ç´°ã‚’ç¢ºèª\n`;
                result += `4. Cloud Runã®èªè¨¼è¨­å®šã‚’ç¢ºèªï¼ˆ--allow-unauthenticatedï¼‰\n`;
            } else if (hasSuccess) {
                result += `âœ… ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ï¼\n`;
                result += `æ¬¡ã¯ã€Œãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã§ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ›¸ãå‡ºã—ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚\n`;
            }

            if (hasError && !hasSuccess) {
                showResult('error', result);
            } else if (hasSuccess) {
                showResult('success', result);
            } else {
                showResult('info', result);
            }
        }
    </script>
</body>
</html>

